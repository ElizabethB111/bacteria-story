import streamlit as st
import pandas as pd
import altair as alt
import numpy as np

# Load data
data = [
    {"Bacteria": "Aerobacter aerogenes", "Penicillin": 870, "Streptomycin": 1, "Neomycin": 1.6, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Bacillus anthracis", "Penicillin": 0.001, "Streptomycin": 0.01, "Neomycin": 0.007, "Gram_Staining": "positive", "Genus": "other"},
    {"Bacteria": "Brucella abortus", "Penicillin": 1, "Streptomycin": 2, "Neomycin": 0.02, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Diplococcus pneumoniae", "Penicillin": 0.005, "Streptomycin": 11, "Neomycin": 10, "Gram_Staining": "positive", "Genus": "other"},
    {"Bacteria": "Escherichia coli", "Penicillin": 100, "Streptomycin": 0.4, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Klebsiella pneumoniae", "Penicillin": 850, "Streptomycin": 1.2, "Neomycin": 1, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Mycobacterium tuberculosis", "Penicillin": 800, "Streptomycin": 5, "Neomycin": 2, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Proteus vulgaris", "Penicillin": 3, "Streptomycin": 0.1, "Neomycin": 0.1, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Pseudomonas aeruginosa", "Penicillin": 850, "Streptomycin": 2, "Neomycin": 0.4, "Gram_Staining": "negative", "Genus": "other"},
    {"Bacteria": "Salmonella (Eberthella) typhosa", "Penicillin": 1, "Streptomycin": 0.4, "Neomycin": 0.008, "Gram_Staining": "negative", "Genus": "Salmonella"},
    {"Bacteria": "Salmonella schottmuelleri", "Penicillin": 10, "Streptomycin": 0.8, "Neomycin": 0.09, "Gram_Staining": "negative", "Genus": "Salmonella"},
    {"Bacteria": "Staphylococcus albus", "Penicillin": 0.007, "Streptomycin": 0.1, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"},
    {"Bacteria": "Staphylococcus aureus", "Penicillin": 0.03, "Streptomycin": 0.03, "Neomycin": 0.001, "Gram_Staining": "positive", "Genus": "Staphylococcus"},
    {"Bacteria": "Streptococcus fecalis", "Penicillin": 1, "Streptomycin": 1, "Neomycin": 0.1, "Gram_Staining": "positive", "Genus": "Streptococcus"},
    {"Bacteria": "Streptococcus hemolyticus", "Penicillin": 0.001, "Streptomycin": 14, "Neomycin": 10, "Gram_Staining": "positive", "Genus": "Streptococcus"},
    {"Bacteria": "Streptococcus viridans", "Penicillin": 0.005, "Streptomycin": 10, "Neomycin": 40, "Gram_Staining": "positive", "Genus": "Streptococcus"}
]

df = pd.DataFrame(data)

# Title
st.title("üß´ Bacteria Resistance Explorer")

# Sidebar filters
st.sidebar.header("üîç Filter Options")
selected_antibiotic = st.sidebar.selectbox("Choose an antibiotic", ["Penicillin", "Streptomycin", "Neomycin"])
selected_gram = st.sidebar.multiselect("Gram Staining", df["Gram_Staining"].unique(), default=df["Gram_Staining"].unique())
selected_genus = st.sidebar.multiselect("Genus", df["Genus"].unique(), default=df["Genus"].unique())

# Filtered dataframe
filtered_df = df[
    df["Gram_Staining"].isin(selected_gram) &
    df["Genus"].isin(selected_genus)
]

# Log transform (optional for better scaling)
filtered_df["log_MIC"] = np.log10(filtered_df[selected_antibiotic])

# Altair plot
st.subheader(f"Resistance to {selected_antibiotic}")
chart = alt.Chart(filtered_df).mark_bar().encode(
    x=alt.X("log_MIC:Q", title=f"log‚ÇÅ‚ÇÄ(MIC for {selected_antibiotic})"),
    y=alt.Y("Bacteria:N", sort='-x'),
    tooltip=["Bacteria", selected_antibiotic, "Gram_Staining", "Genus"]
).properties(
    width=700,
    height=500
).interactive()

st.altair_chart(chart)

# Data table
with st.expander("üìÑ View Filtered Data"):
    st.dataframe(filtered_df.sort_values(by=selected_antibiotic))

